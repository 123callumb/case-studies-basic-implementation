@model VendorCatalogueViewModel
@{
    ViewData["Title"] = "Vendor Catalogue";
}

<style>
    .localBG {
        background-color: #97D99D;
    }

    .searchBar {
        width: 100%;
        margin: auto;
        margin-top: 5px;
    }

        .searchBar > div:first-of-type {
            background-color: rgb(240, 240, 240);
            display: inline-flex;
        }

        .searchBar > div:last-of-type:hover {
            cursor: pointer;
        }

        .searchBar input {
            border: 0;
            background-color: transparent;
            margin: 12px;
            flex: 1;
        }

            .searchBar input:focus {
                border: 10px;
                outline: 0;
            }

    .catalogueItem {
        display: flex;
        flex-direction: row;
    }

    .listingImage {
        flex: 1;
        width: 20%;
        border: 1px solid black;
        background-size: cover;
        background-repeat: no-repeat;
    }

        .listingImage > img {
            width: 100%;
        }

    .listingContent {
        padding: 0px 20px;
        width: 60%;
    }

    .subtitile {
        margin-bottom: 0;
        font-weight: 600;
    }

    .listingNav {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-evenly;
        text-align: center;
        padding-left: 20px;
    }

    .listingButton {
        display: flex;
        padding: 12px;
        font-weight: 600;
    }

        .listingButton:hover {
            cursor: pointer;
        }

        .listingButton > input {
            flex: 1;
            border: 0;
            text-align: center;
            background-color: transparent;
        }

            .listingButton > input:focus {
                outline: 0;
            }

        .listingButton > span {
            color: white;
            flex: 1;
        }
</style>

<div class="text-center">
    <img class="my-5 shadow-lg rounded" src="~/img/ABCEnergyLogo.PNG" />
    <div class="d-flex flex-column flex-sm-row align-items-center">
        <!-- Breadcrumb, User name, Home button and Logout button -->
        <ol class="breadcrumb me-auto">
            <li class="breadcrumb-item" aria-current="page">@Html.ActionLink("Home", "Index", "Home", null, new { @class = "btn-link" })</li>
            <li class="breadcrumb-item" aria-current="page">@Html.ActionLink("Vendor", "VendorMenu", "Home", null, new { @class = "btn-link" })</li>
            <li class="breadcrumb-item active" aria-current="page">Catalogue</li>
        </ol>
        <div class="me-3">@Model.user.Email</div>
        @Html.ActionLink("Home", "Index", "Home", null, new { @class = "btn-link" })
        <a class="btn btn-link" href="@Url.Action("LogoutUser", "Authentication")">Logout</a>
    </div>
</div>
@* Alerts *@
@if (Model.quantiyResult.success)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert" id="successAlert">
        Quote request for <strong><span>@Model.quantiyResult.quantity</span>x "@Model.quantiyResult.itemName"</strong> successful!
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
else if(Model.quantiyResult.quantity != 0)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert" id="errorAlert">
        Something went wrong when requesting quote for <strong><span>@Model.quantiyResult.quantity</span>x "@Model.quantiyResult.itemName"</strong>.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@*search bar *@
<div class="p-3 bg-white">
    <div style="text-align:right;" class="localBG">
        <span class="material-icons-outlined" style="color:white; padding:5px;">
            next_week
        </span>
    </div>
    <div class="row searchBar">
        <div class="col-10">
            <div style="width:4%; min-width:30px;">
                <span class="material-icons" style="padding:14px;">
                    search
                </span>
            </div>
            <div class="width:96%" style="display: flex; flex:1">
                <input type="text" id="searchInput" onkeydown="readInput(this, event)" placeholder="@ViewBag.SearchTerm" />
            </div>
        </div>
        <div class="col-2 cs-vendor text-center" id="searchButton" style="color:white; padding:15px; font-weight:600;">
            Search
        </div>
    </div>
</div>

<p style="font-weight:600; margin-bottom:0; margin-top:10px;">Showing Results @Model.VendorItems.Count() of @Model.VendorItems.Count()</p>
@for (int i = 0; i < Model.VendorItems.Count(); i++)
{
    @* results *@
    <div class="p-3 bg-white catalogueItem">
        <div class="listingImage" style="background-image:url(@Model.VendorItems[i].ItemImageURL)">
        </div>
        <div class="listingContent">
            <h3>@Model.VendorItems[i].ItemName</h3>
            <p class="subtitile">Supplier</p>
            <p>@Model.VendorItems[i].VendorName</p>
            <p class="subtitile">description</p>
            <p>@Model.VendorItems[i].ItemDescription</p>
        </div>
        <hr width="1" size="150">
        <div class="listingNav">
            <div class="listingButton" style="background-color: rgb(240, 240, 240);">
                <input id="quantity_@Model.VendorItems[i].ItemID" type="number" placeholder="Enter Quantity" />
            </div>
            <div class="listingButton cs-vendor" onclick="requestQuote(@Model.VendorItems[i].ItemID)">
                <span>Request quote</span>
            </div>
        </div>
    </div>
    <br />
}

@*<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>*@

@section Scripts{
    <script type="text/javascript">
        window.onload = function () {
            document.getElementById("searchInput").focus();
        };

        function runAction() {
            location.href = '@Url.Action("VendorCatalogueSearch", "Home")?searchTerm=' + document.getElementById('searchInput').value;
        }

        function readInput(el, e) {
            if (e.keyCode == 13) {
                runAction();
            }
        }

        document.getElementById('searchButton').addEventListener('click', function () {
            runAction();
        });

        function requestQuote(vendorItemID) {

            var quantityInput = document.getElementById("quantity_" + vendorItemID);
            var quantity = quantityInput.value;
            if (quantity > 0) {
                var url = '@Url.Action("RequestVendorQuote", "Home")?vendorItemID=' + vendorItemID + "&quantity=" + quantity;
                if (document.getElementById('searchInput').value != "") url = url +"&searchTerm=" + document.getElementById('searchInput').value;
                console.log(url);
                location.href = url;
            } else quantityInput.parentElement.style.border = "1px solid red";            
        }
    </script>
}